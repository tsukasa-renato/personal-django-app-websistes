{% load static %}
{% load filters %}


<form method="post" action="{% url 'websites:addtocart' url=websites.url product=product.slug %}" id="options_form">
    {% csrf_token %}
</form>

<script>
    $(document).ready(function(){

        var total = 0

        {% for group in groups %}

            var radio = ""

            {% if group.maximum == 1 and group.minimum == 1 %}
                radio = "radio"
            {% endif %}
            console.log(radio)
            $("#options_form").append(function(){

                return  "<div class='row p-1'>" +
                            "<div class='col-sm' id='{{ group.slug }}_images'>" +

                            "</div>" +
                            "<div class='col-sm'>" +
                                "<h5 id='{{ group.slug }}_title'> </h5>" +
                                "<p class='overflow-auto' style='max-height:300px;' " +
                                "id='{{ group.slug }}_description'> </p>" +
                            "</div>" +
                        "</div>" +

                        "<div class='row justify-content-center'>" +
                            "<h4> {{ group.title }} </h4>" +
                        "</div>" +
                        "<div class='row justify-content-center' id='{{ group.slug }}'>" +
                            "<p class='d-none' id='{{ group.slug }}_type'>" + radio + "</p>" +
                            "<p class='d-none' id='{{ group.slug }}_total'> 0 </p>" +
                            "<!-- Options -->" +
                        "</div>";
            });

        {% endfor %}

        {% for option in options %}

            var type_input = $("#{{ option.groups }}_type").text()
            var div_input = "check"
            var value_input = "value='{{ option.id }}'"
            var option_text = ""
            var checked = ""
            var readonly = ""

            {% if option.price %}
                option_text = "{% money_format option.price websites.currency %}"
            {% else %}
                option_text = "{{ option.title }}"
            {% endif %}

            if (type_input != 'radio') {
                {% if option.max == 1 %}
                    type_input = "checkbox"
                {% else %}
                    type_input = "number"
                    div_input = "control"
                    value_input = "value='{{ option.minimum }}' min='{{ option.minimum }}' max='{{ option.maximum }}'"
                {% endif %}
                $("#{{ group.slug }}_type").text(type_input)
            }

            {% if option.maximum == option.minimum %}
                readonly = "readonly"
            {% endif %}

            {% if forloop.counter == 1 %}

                $("#{{ option.groups }}_title").append("{{ option.title }}")
                $("#{{ option.groups }}_description").append("{{ option.description|linebreaks }}")
                $("#{{ option.groups }}_total").text("{{ option.price }}")

                {% if option.images %}
                $("#{{ option.groups }}_images").html("<img src='{{ option.images.url }}' class='img-fluid' " +
                                "alt='{{ option.slug }}' style='max-height:400px;'>")
                {% endif %}

                total += parseFloat("{{ option.price }}")
                checked = "checked"

            {% endif %}

            $("#{{ option.groups }}").append(function() {

                return  "<div class='form-" + div_input + " mr-1'>" +

                        "<input class='form-check-input' type=" + type_input + " name='option' id='{{ option.id }}' " +
                        value_input + " " + checked + " " +
                        readonly + ">" +

                        "<label class='form-check-label btn-primary rounded p-1' for='{{ option.id }}'>" +

                        {% if option.images %}
                        "<img src='{{ option.images.url }}' class='rounded-circle mr-1' " +
                                "alt='{{ option.slug }}' style='width: 30px;height: 30px;'>" +
                        {% endif %}

                        option_text +

                        "</label>" +
                        "</div>";
            });

            $("#{{option.id}}").click(function(){

                $("#{{ option.groups }}_title").empty()
                $("#{{ option.groups }}_description").empty()

                $("#{{ option.groups }}_title").append("{{ option.title }}")
                $("#{{ option.groups }}_description").append("{{ option.description|linebreaks }}")

                {% if option.images %}
                $("#{{ option.groups }}_images").html("<img src='{{ option.images.url }}' class='img-fluid' " +
                                "alt='{{ option.slug }}' style='max-height:400px;'>")
                {% endif %}

                if (type_input == 'radio') {
                    total -= parseFloat($("#{{ option.groups }}_total").text())
                    total += parseFloat("{{ option.price }}")
                    $("#{{ option.groups }}_total").text("{{ option.price }}")
                } else if (type_input == 'checkbox') {
                    total += parseFloat("{{ option.price }}")
                    $("#{{ option.groups }}_total").text("{{ option.price }}")
                } else {
                    total += parseFloat("{{ option.price }}")
                    $("#{{ option.groups }}_total").text("{{ option.price }}")
                }

                console.log(total)

            });

        {% endfor %}

        $("#options_form").append(function(){
            return "<div class='row navbar mt-3'>" +
                        "<div class='col text-center text'>" +
                            "<h5> Final Price R$ 0,00 </h5>" +
                            "<button type='submit' class='btn btn-success'>" +
                                "<b> + </b> Add to Cart" +
                            "</button>" +
                        "</div>" +
                    "</div>";
        });

    });


</script>